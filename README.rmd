
---
bibliography: vignettes/bibliography.bib
output: 
  github_document:
    df_print: kable
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
```{r packages, message = FALSE, warning=FALSE, echo = FALSE}
# Chargement des packages
library(tidyverse)
library(here)
library(gt)
```


# Indice Biologique Diatomées en Lac (IBDL) <img src='man/figures/logo.png' align="right" height="139" />

<!-- badges: start -->
[![Lifecycle:experimental](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
[![packageversion](https://img.shields.io/badge/Package%20version-0.0.1-orange.svg?style=flat-square)](commits/master)
[![Licence](https://img.shields.io/badge/licence-GPL--3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0.en.html)
<!-- [![R build status](https://github.com/SebastienBoutry/IBDL/workflows/R-CMD-check/badge.svg)](https://github.com/SebastienBoutry/IBDL/actions) -->
<!-- badges: end -->


# Installation de `{IBDL}`

La version du paquet `{IBDL}` peut se télécharger via le site Github pour cela on aura besoin du paquet `{remotes}`: 

```{r install, eval=FALSE}
remotes::install_github("SebastienBoutry/IBDL")
```

_NB : Le logiciel RTools est parfois nécessaire sur les machines Windows pour pouvoir installer le package `{remotes}`, puisque l'installation ici se fait depuis un dépôt de développement (Github) et non un dépôt officiel R. Vous pouvez l'installer ici : [Rtools](https://cran.r-project.org/bin/windows/Rtools/)_

Une fois installé, vous pouvez charger le package avec :

```{r eval = FALSE}
library(IBDL)
```
# Objectif

L'objectif de ce package `{IBDL}` est de fournir les fonctions nécessaires pour calculer l'Indice Biologique Diatomées en Lac.


_NB : L'IBDL a été développé par l'équipe ECOVEA (INRAE, unité EABX) dans le projet Phytobenthos plan d'eau financé par l'OFB-Pôle ECLA._

# Utilisation

Le package `{IBDL}` sert à calculer l'indice biologique diatomées en lac afin de donner une valeur et une classe d'état écologique du plan d'eau étudié (conforme à la Directive Cadre Européenne sur l'Eau [@directive2000water]).

## Les besoins 

En utilisant le protocole d'échantillonnage [@Morin2018], on importe deux fichiers :

- le premier contient les listes floristiques (id_prelevement, taxons, ab),
- le second renseigne sur les données de contexte liées au site d'étude (id_prelevement, id_uo, nature_substrat, code_gene, date).


### Données internes embarquées

Les autres jeux de données dit de référence sont intégrés directement dans le package.

**`table_transcodage`** : Table de transcodage permettant de faire correspondre le code_taxon 4 lettres  (type OMNIDIA) à son entité taxonomique qui a été considérée pour la construction de l'IBDL. Le choix pour l'indice est d'harmoniser les taxons à un rang taxonomique de l'espèce. On a pris en compte la synonymie et l'héritage taxonomique. 

Dans l'extrait ci-dessous, les deux premières colonnes correspondent au code taxon et le nom scientifique associé. Les trois dernières colonnes sont les informations définies lors de la construction de l'indice. Le rang taxonomique à l'espèce a été ciblé. Le tableau ci-dessous correspond à tous les taxons ayant un code taxon (indice) pour valeur CBCU (_Cymbopleura cuspidata_). 

```{r echo = FALSE}
load("R/sysdata.rda")
table_transcodage %>% 
  select(abre,denominations_sans_auteur.x,code_espece_boucle2,denominations_sans_auteur.y,niveau2) %>% 
   filter(code_espece_boucle2=="CBCU") %>% 
  rename("code_taxon"="abre",
         "nom scientifique"="denominations_sans_auteur.x",
         "nom scientifique (indice)"="denominations_sans_auteur.y",
         "code_taxon (indice)"="code_espece_boucle2",
         "rang taxonomique (indice)"="niveau2") %>% 
  gt() %>% 
  tab_spanner(
    label = "Harmonisation indicielle",
    columns = c("nom scientifique (indice)",
         "code_taxon (indice)",
         "rang taxonomique (indice)")
  ) %>% 
  tab_style(
    style = list(
      cell_fill(color = "#66C1BF"),
      cell_text(style = "italic",color="#FFFFFF")
      ),
    locations = cells_body(
      columns = c("nom scientifique (indice)",
         "code_taxon (indice)",
         "rang taxonomique (indice)")
    )
  ) %>% 
  tab_style(
    style = list(
      # cell_fill(color = "#F9E3D6"),
      cell_text(style = "italic")
      ),
    locations = cells_body(
      columns = "nom scientifique"
    )
  ) %>% 
  tab_header(
    title = md("Taxons correspondant à l'espèce _Cymbopleura cuspidata_ (CBCU)"),
    subtitle = "(extrait de la table de transcodage)"
  ) %>% 
  # tab_options(column_labels.background.color ="#275662" ) %>% 
   tab_source_note(
    source_note = "Table créée à partir du fichier d'Omnidia (Michel Coste)"
  ) 
```

**`table_taxons_alertes`** Table binaire indiquant si le taxon est considéré comme indiciel et/ou d'alerte selon les paramètres (DBO5, MES, NKJ et Ptot). 


```{r taxons alertes, echo=FALSE,fig.align='center',fig.pos="center"}
Table_taxons_alertes[1:6,] %>% 
  rename("code_taxon"="taxons_indiciels") %>% 
  gt() %>% 
  # tab_spanner(
  #   label = "Harmonisation indicielle",
  #   columns = c("nom scientifique (indice)",
  #        "code_taxon (indice)",
  #        "rang taxonomique (indice)")
  # ) %>% 
  # tab_header(
  #   title = md("Table des taxons d'alertes"),
  #   subtitle = "(extrait des 6 premières lignes)"
  # ) %>% 
  tab_options(column_labels.background.color ="#275662",
              table.align="center") %>%
  tab_source_note(
    source_note = "Sortie de l'analyse Titan"
  ) 
```


**`table_reference`**

**`table_lacs`** Table regroupant les informations sur la classification des lacs selon l'alcalinité et le nombre théoriques d'unités d'observation à échantillonner sur le plan d'eau selon leur superficie [@afnorXP].

```{r lacs, echo=FALSE}
lake_infos[1:6,] %>% 
  gt()
```



(la table des taxons d'alertes, la table de transcodage, la table de classification des plans d'eau, la table des valeurs de référence).

<div align="center">

<img src = "man/figures/1_script_IBDL_besoins.png" align="center" height="600"/>

</div>

## Les étapes

On trouvera les fonctions utiles selon le cheminement (-ref-) afin d'évaluer la qualité écologique de la masse d'eau à partir des communautées de diatomées benthiques. 

Certaines fonctions permettent de : 

- harmoniser les données,
- qualifier/valider les données ou les métriques,
- calculer les métriques selon un grain spatial (prélèvement, unité d'observation et lac).

Toutes les fonctions seront détaillées dans la vignette du package.


<div align="center">

<img src = "man/figures/2_phases_programmation.png" label="steps" align="center" height="600"/>

</div>

# Contact

<div align="center">

&nbsp;&nbsp;&nbsp;:e-mail: [Email][Email]&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;:speech_balloon: [Twitter][Twitter]&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;:necktie: [LinkedIn][LinkedIn]

<!--
Quick Link
-->
[Twitter]:https://twitter.com/SebBoutry
[LinkedIn]:https://www.linkedin.com/in/s%C3%A9bastien-boutry-4a77ba10/
[Email]:mailto:sebastien.boutry@inrae.fr


</div>

# Références

ref article
ref rapport OFB
